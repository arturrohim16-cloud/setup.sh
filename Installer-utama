#!/bin/bash
# Installer AJI MASTER SYSTEM V16
# -----------------------------------------

# Clear layar dan minta Domain di awal
clear
echo -e "═══════════════════════════════════════════════════"
echo -e "      SELAMAT DATANG DI INSTALLER AJI MASTER"
echo -e "═══════════════════════════════════════════════════"
read -p " Masukkan Domain Anda : " domain
if [[ -z $domain ]]; then
    echo " Error: Domain tidak boleh kosong!"
    exit 1
fi

# Simpan domain ke folder sistem agar terbaca oleh Menu
mkdir -p /etc/xray
echo "$domain" > /etc/xray/domain
echo "$domain" > /root/domain

# 1. Update & Install Dependencies
apt update -y
apt upgrade -y
apt install -y software-properties-common curl wget sudo socat cron bash-completion ntpdate
apt install -y net-tools vnstat jq bsdmainutils python3 python3-pip

# 2. Buat Direktori Kerja
mkdir -p /etc/aji
mkdir -p /var/log/xray
touch /etc/aji/users.db

# 3. Setup Timezone (Jakarta)
timedatectl set-timezone Asia/Jakarta

# 4. Install Xray Core
echo -e "Installing Xray Core..."
bash -c "$(curl -L https://github.com/XTLS/Xray-install/raw/main/install-release.sh)" @ install

# 5. Konfigurasi Xray Minimalis agar service bisa jalan
cat > /etc/xray/config.json <<EOF
{
    "log": { "access": "/var/log/xray/access.log", "error": "/var/log/xray/error.log", "loglevel": "warning" },
    "inbounds": [
        {
            "port": 443, "protocol": "vless", "settings": { "clients": [], "decryption": "none" },
            "streamSettings": { "network": "ws", "security": "none" }
        }
    ],
    "outbounds": [{ "protocol": "freedom", "settings": {} }]
}
EOF

# 6. Ambil File Menu Master
echo -e "Downloading Menu Master..."
wget -q -O /usr/bin/menu "https://raw.githubusercontent.com/arturrohim16-cloud/Ajimaster-scriot/refs/heads/main/Scriptku"
chmod +x /usr/bin/menu

# 7. Selesai
systemctl restart xray
clear
echo -e "═══════════════════════════════════════════════════"
echo -e "       INSTALLASI SELESAI - AJI MASTER V16"
echo -e "═══════════════════════════════════════════════════"
echo -e " Domain Anda : $(cat /etc/xray/domain)"
echo -e " Ketik 'menu' untuk membuka dashboard"
echo -e "═══════════════════════════════════════════════════"

